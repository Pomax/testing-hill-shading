<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Hello (Hill-Shaded) World!</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="/script.js" type="module" async></script>
  </head>
  <body>
    <h1>Let's test some hill shading</h1>

    <p>
      Ever seen a map that changes shading? Move your cursor or tap anywhere in
      the map below to change the sun's position!
    </p>

    <canvas id="cvs"></canvas>

    <p>How does this work?</p>

    <p>We have a 16 bit grayscale DEM height map:</p>

    <figure>
      <img
        style="max-height: 40vh"
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/ALPSMLC30_N048W124_DSM.900m.png?v=1687792965948"
      />
    </figure>

    <p>
      ...super exciting, let's level that a little so you can actually see what
      data it captures:
    </p>

    <figure>
      <img
        style="max-height: 40vh"
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/ALPSMLC30_N048W124_DSM.900m.png?v=1687807910178"
      />
    </figure>

    <p>
      We can compute the "surface normal" for each pixel by looking at its four
      direct neighbours, creating a vector {a-b,c-d,2} where "a" and "b" are the
      height at (x-1,y) and (x+1,y) respectively, and "c" and "d" are the height
      at (x,y-1) and (x,y+1), respectively. If we normalize that vector and then
      render it as if it were an {R,G,B} vector, that looks like:
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/ca49a69d-9691-4aa3-82fa-2f9d7cc13977.image.png?v=1687808057302"
      />
    </figure>

    <p>
      We then compute how much light would get reflected "up" into the screen,
      given an illumination vector, using the standard
      <a href="https://en.wikipedia.org/wiki/Reflection_(mathematics)"
        >vector reflection</a
      >
      approach:
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/4ebb214e-ce20-4ced-a695-d5c55d79e79b.image.png?v=1687808402386"
      />
    </figure>

    <p>
      We can also take our height map and, using the
      <a href="https://en.wikipedia.org/wiki/Marching_squares"
        >Marching Squares</a
      >
      algorithm, find all regions that have the same elevation (in brackets, so
      we get "bands"):
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/1ae33f7f-1734-4858-8389-c431a1371c9e.image.png?v=1688153884945"
      />
    </figure>

    <p>
      And we can can then fill in the areas between these
      <a href="https://en.wikipedia.org/wiki/Contour_line">"isolines"</a> using
      some false color designed to look appropriate to the elevation we're
      coloring in, so: green for low altitudes, brown (less/no vegetation) for
      high altitudes, blue/white (snow) for really high altitudes:
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/6a6ce669-97d4-46ed-9e44-4be3dea6899f.image.png?v=1688153947136"
      />
    </figure>

    <p>
      If we then make the iso lines themslves less pronounced, we can overlay
      our "shaded" black and white image using the
      <a href="https://en.wikipedia.org/wiki/Blend_modes#Dodge_and_burn"
        >color-burn</a
      >
      method, (after blurring it a little), to generate the general, subtle
      shading:
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/5f62ae82-a8e5-442d-8b17-cd8c5ef1baf0.image.png?v=1688154522358"
      />
    </figure>

    <p>
      After which we add the shaded height map as a 70% transparent overlay,
      without blurring, to bring out the geographic features without making
      everything look jagged and terrible:
    </p>

    <figure>
      <img
        src="https://cdn.glitch.global/6f093c76-7f96-4f52-94dd-2b1647bfb115/6c53bf48-e957-49fb-942f-6018c14d3ce1.image.png?v=1688155820711"
      />
    </figure>

    <p>
      If we then tie the illumination vector to where the cursor is on the
      canvas, we can change the way the terrain gets lit simply by moving the
      cursor around!
    </p>

    <!-- The footer holds our remix button — you can keep or delete it ✂ -->
    <footer class="footer">
      <div class="links"></div>
      <a
        class="btn--remix"
        target="_top"
        href="https://glitch.com/edit/#!/remix/glitch-hello-website"
      >
        <img
          src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140"
          alt=""
        />
        Remix on Glitch
      </a>
    </footer>
  </body>
</html>
